# ๐ DeliveryVLG - ะกะธััะตะผะฐ ะดะฒัั ะบะพะฝัััะพะฒ (Dev/Prod)

## ๐ ะะฑะทะพั ัะธััะตะผั

ะกะธััะตะผะฐ **DeliveryVLG** ัะตะฟะตัั ัะฐะฑะพัะฐะตั ั ะดะฒัะผั ะธะทะพะปะธัะพะฒะฐะฝะฝัะผะธ ะบะพะฝัััะฐะผะธ:
- **ะะะะะะะจะ** (ะฟะพัั 3000/3443) - ัะฐะฑะพัะตะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- **ะะะะะะะะขะะ** (ะฟะพัั 3001/3444) - ัะตััะพะฒะฐั ััะตะดะฐ ะดะปั ัะฐะทัะฐะฑะพัะบะธ

### ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   ะะะะะะะจะ      โ    โ   ะะะะะะะะขะะ    โ
โ   PORT: 3000    โ    โ   PORT: 3001    โ
โ   HTTPS: 3443   โ    โ   HTTPS: 3444   โ
โ   DB: delivery  โ    โ   DB: delivery-devโ
โ   ENV: productionโ    โ   ENV: developmentโ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ
         โโโโโโโโโโโโโฌโโโโโโโโโโโโ
                     โ
              โโโโโโโโโโโโโโโ
              โ  Git Repo   โ
              โ  main โโ devโ
              โโโโโโโโโโโโโโโ
```

## ๐ Workflow ัะฐะทัะฐะฑะพัะบะธ

### 1. **ะะถะตะดะฝะตะฒะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ**
```bash
# ะะตัะตะบะปััะธัััั ะฝะฐ dev ะพะบััะถะตะฝะธะต
./scripts/switch-env.sh development

# ะะฝะตััะธ ะธะทะผะตะฝะตะฝะธั ะฒ ะบะพะดะต
# ะขะตััะธัะพะฒะฐัั ะฝะฐ dev ัะตัะฒะตัะต (localhost:3001)

# ะะฐะฟัััะธัั ะฐะฒัะพัะตััั
npm test

# ะัะปะธ ะฒัะต ะะ - ะฟะพะดะณะพัะพะฒะธัั ะบ ะดะตะฟะปะพั
./scripts/deploy-dev.sh
```

### 2. **ะะตัะตะฝะพั ะฒ ะฟัะพะดะฐะบัะฝ**
```bash
# ะฃะฑะตะดะธัััั ััะพ dev ัะตััั ะฟัะพัะปะธ
./scripts/check-both.sh

# ะะตัะตะบะปััะธัััั ะฝะฐ main ะฒะตัะบั
git checkout main
git merge develop

# ะะตะฟะปะพะน ะฒ ะฟัะพะดะฐะบัะฝ ั ัะตััะฐะผะธ
./scripts/deploy-prod.sh
```

### 3. **ะญะบัััะตะฝะฝัะน ะพัะบะฐั**
```bash
# ะัััััะน ะพัะบะฐั ะบ ะฟัะตะดัะดััะตะน ะฒะตััะธะธ
git checkout main
git reset --hard HEAD~1
sudo systemctl restart delivery-app
```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
delivery-app/
โโโ ๐ง ะะพะฝัะธะณััะฐัะธั
โ   โโโ .env              # ะัะพะดะฐะบัะฝ ะฝะฐัััะพะนะบะธ
โ   โโโ .env.dev          # Dev ะฝะฐัััะพะนะบะธ
โ   โโโ package.json      # ะะฐะฒะธัะธะผะพััะธ ะธ ัะบัะธะฟัั
โโโ ๐ ะัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ server.js         # ะกะตัะฒะตั ั ะฟะพะดะดะตัะถะบะพะน ะพะบััะถะตะฝะธะน
โ   โโโ database.js       # ะะ ะปะพะณะธะบะฐ (ัะฐะทะฝัะต ัะฐะนะปั)
โ   โโโ public/           # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั
โโโ ๐งช ะขะตััะธัะพะฒะฐะฝะธะต
โ   โโโ test/
โ   โ   โโโ basic-tests.js    # API ัะตััั
โ   โ   โโโ security-tests.js # ะะตะทะพะฟะฐัะฝะพััั
โโโ ๐ ะกะบัะธะฟัั ัะฟัะฐะฒะปะตะฝะธั
โ   โโโ scripts/
โ       โโโ check-both.sh     # ะัะพะฒะตัะบะฐ ัะตัะฒะตัะพะฒ
โ       โโโ deploy-dev.sh     # ะะตะฟะปะพะน dev
โ       โโโ deploy-prod.sh    # ะะตะฟะปะพะน ะฟัะพะดะฐะบัะฝ
โ       โโโ switch-env.sh     # ะะตัะตะบะปััะตะฝะธะต ะพะบััะถะตะฝะธะน
โโโ ๐ ะะพะบัะผะตะฝัะฐัะธั
    โโโ README-DevProd-Workflow.md  # ะญัะพั ัะฐะนะป
    โโโ scripts-reference.md        # ะกะฟัะฐะฒะบะฐ ะฟะพ ัะบัะธะฟัะฐะผ
    โโโ troubleshooting.md          # ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ
```

## ๐ฏ ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ
```bash
# ะกัะฐััั ะพะฑะพะธั ะบะพะฝัััะพะฒ
./scripts/check-both.sh

# ะกัะฐััั systemd ัะตัะฒะธัะพะฒ
sudo systemctl status delivery-app        # ะัะพะดะฐะบัะฝ
sudo systemctl status delivery-app-dev    # Dev
```

### ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะฒะธัะฐะผะธ
```bash
# ะะตัะตะทะฐะฟััะบ ัะตัะฒะธัะพะฒ
sudo systemctl restart delivery-app       # ะัะพะดะฐะบัะฝ
sudo systemctl restart delivery-app-dev   # Dev

# ะัะพัะผะพัั ะปะพะณะพะฒ
sudo journalctl -fu delivery-app          # ะัะพะดะฐะบัะฝ ะปะพะณะธ
sudo journalctl -fu delivery-app-dev      # Dev ะปะพะณะธ
```

### ะขะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะฒัะพัะตััั ะดะปั dev
NODE_ENV=development npm test

# ะะฒัะพัะตััั ะดะปั ะฟัะพะดะฐะบัะฝ
NODE_ENV=production npm test

# ะขะตััั ะฑะตะทะพะฟะฐัะฝะพััะธ
npm run test:security
```

## ๐ฟ Git ัััะฐัะตะณะธั

### ะะตัะบะธ
- **`main`** - ะฟัะพะดะฐะบัะฝ ะฒะตััะธั (ะทะฐัะธัะตะฝะฝะฐั)
- **`develop`** - dev ะฒะตััะธั (ะฐะบัะธะฒะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ)

### ะัะพัะตัั
1. ะะฐะทัะฐะฑะพัะบะฐ ะฒ `develop`
2. ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ dev ะบะพะฝัััะต
3. Merge ะฒ `main` ัะพะปัะบะพ ะฟะพัะปะต ัะตััะพะฒ
4. ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน ะฒ ะฟัะพะดะฐะบัะฝ

### ะัะธะผะตัั ะบะพะผะฐะฝะด
```bash
# ะกะพะทะดะฐะฝะธะต feature
git checkout develop
git checkout -b feature/new-function
# ... ัะฐะทัะฐะฑะพัะบะฐ ...
git checkout develop
git merge feature/new-function

# ะะตัะตะฝะพั ะฒ ะฟัะพะดะฐะบัะฝ
git checkout main
git merge develop --no-ff
git push origin main
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะะฐะทะดะตะปะตะฝะธะต ะพะบััะถะตะฝะธะน
- โ ะะฐะทะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั
- โ ะะฐะทะฝัะต ะฟะพััั
- โ ะะฐะทะฝัะต ะบะพะฝัะธะณััะฐัะธะธ
- โ ะะทะพะปััะธั ะฟัะพัะตััะพะฒ

### ะัะฐะฒะฐ ะดะพัััะฟะฐ
- **ะัะพะดะฐะบัะฝ**: ัะพะปัะบะพ admin ะฟะพะปัะทะพะฒะฐัะตะปะธ
- **Dev**: ัะฐะทัะฐะฑะพััะธะบะธ + ัะตััะธัะพะฒัะธะบะธ
- **ะกะบัะธะฟัั ะดะตะฟะปะพั**: ััะตะฑััั ะฟะพะดัะฒะตัะถะดะตะฝะธั

### ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต
```bash
# ะกะพะทะดะฐะฝะธะต backup ะฟัะพะดะฐะบัะฝะฐ (ะฐะฒัะพะผะฐัะธัะตัะบะธ)
./scripts/deploy-prod.sh  # ัะพะทะดะฐะตั backup ะฟะตัะตะด ะดะตะฟะปะพะตะผ

# ะััะฝะพะต ัะพะทะดะฐะฝะธะต backup
tar -czf "delivery-backup-$(date +%Y%m%d-%H%M).tar.gz" \
    --exclude="node_modules" \
    --exclude="*.log" \
    /home/enclude/delivery-app
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะปััะตะฒัะต ะผะตััะธะบะธ
- Uptime ัะตัะฒะตัะพะฒ
- ะัะตะผั ะพัะฒะตัะฐ API
- ะัะธะฑะบะธ ะฒ ะปะพะณะฐั
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ

### ะะปะตััั
```bash
# ะัะพะฒะตัะบะฐ health check
curl -s http://localhost:3000/health || echo "PROD DOWN!"
curl -s http://localhost:3001/health || echo "DEV DOWN!"
```

## ๐ ะััััะพะต ัะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะพะฑะปะตะผะฐ: ะกะตัะฒะตั ะฝะต ะพัะฒะตัะฐะตั
```bash
./scripts/check-both.sh
sudo systemctl restart delivery-app
```

### ะัะพะฑะปะตะผะฐ: ะะพะฝัะปะธะบั ะฟะพััะพะฒ
```bash
# ะะฐะนัะธ ะฟัะพัะตัั ะฝะฐ ะฟะพััั
sudo lsof -i :3000
# ะฃะฑะธัั ะฟัะพัะตัั
sudo kill -9 PID
```

### ะัะพะฑะปะตะผะฐ: ะัะธะฑะบะธ ะฒ ัะตััะฐั
```bash
# ะัะธััะธัั ะบัั ะธ ะฟะตัะตัััะฐะฝะพะฒะธัั
npm cache clean --force
rm -rf node_modules
npm install
```

### ะัะพะฑะปะตะผะฐ: ะะ ะฝะต ะพัะฒะตัะฐะตั
```bash
# ะัะพะฒะตัะธัั ัะฐะนะปั ะะ
ls -la *.db
# ะะพัััะฐะฝะพะฒะธัั ะฟัะฐะฒะฐ
chmod 664 delivery*.db
```

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:
1. ะัะพะฒะตัััะต ััะฐััั ะบะพะผะฐะฝะดะพะน `./scripts/check-both.sh`
2. ะะพัะผะพััะธัะต ะปะพะณะธ: `sudo journalctl -fu delivery-app`
3. ะะฐะฟัััะธัะต ัะตััั: `npm test`
4. ะะฑัะฐัะธัะตัั ะบ ะดะพะบัะผะตะฝัะฐัะธะธ ะฒ ะฟะฐะฟะบะต `docs/`

---
*ะะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ: $(date +"%Y-%m-%d %H:%M")*
*ะะตััะธั ัะธััะตะผั: 2.0 (Dual Environment)* 